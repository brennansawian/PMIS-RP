<!DOCTYPE html>
<html
        lang="en"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:th="http://thymeleaf.org"
        layout:decorate="~{layouts/admin-layout}"
>
<head>
  <title>Offices</title>
  <div layout:fragment="static-files">
    <link rel="stylesheet" type="text/css" th:href="@{/css/auditTrail.css}"></div>
</head>
<body>

<main layout:fragment="content">
  <div class="container pb-4">
    <br>
    <div class="card box-shadow-grey">
      <h4 class="card-title titlecss"><i class="fa fa-list"> Â Audit Trail Report</i></h4>
      <hr>
      <div class="card-body">
        <div id="message-container" class="mb-3"></div>

        <!-- Search Controls and Excel Button -->
        <form th:action="@{/nerie/admin/audittrail}" method="get">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3">

            <!-- Left side controls -->
            <div class="d-flex flex-column flex-sm-row align-items-sm-center">
              <div class="d-flex align-items-center mb-2 mb-sm-0 mr-md-3">
                <label for="pageSizeSelect" class="mb-0 mr-2 text-nowrap">Show</label>
                <select id="pageSizeSelect" name="size" class="custom-select custom-select-sm" style="width: auto;" onchange="this.form.submit();">
                  <option th:each="s : ${ {5, 10, 25, 50, 100} }" th:value="${s}" th:text="${s}" th:selected="${s == auditPage.size}"></option>
                </select>
              </div>

              <div class="d-flex align-items-center mb-2 mb-sm-0">
                <label for="search-input" class="mb-0 mr-2 text-nowrap">Search:</label>
                <input type="text" id="search-input" name="keyword" class="form-control form-control-sm" th:value="${keyword}" placeholder="Search...">
                <button type="submit" class="btn btn-custom-search btn-sm ml-2 text-nowrap">Search</button>
                <a th:href="@{/nerie/admin/audittrail(size=${auditPage.size})}" class="btn btn-custom-clear btn-sm ml-2 text-nowrap">Clear</a>
              </div>
            </div>
            <div class="d-flex align-items-center mt-2 mt-md-0">
              <div id="export-buttons-container"></div>
            </div>
          </div>
        </form>

        <div class="pb-2">
          <span>entries</span>
        </div>

        <div class="table-responsive">
          <table class="table table-striped table-bordered center-sans-serif" id="audittable" style="width:100%">
            <thead class="fs-14">
            <tr>
              <th th:text="'Sl No.'"></th>
              <th th:text="'User ID'"></th>
              <th th:text="'Action'"></th>
              <th th:text="'Page Accessed'"></th>
              <th th:text="'Browser/OS'"></th>
              <th th:text="'IP Address'"></th>
              <th th:text="'Date/Time'"></th>
            </tr>
            </thead>
            <tbody class="fs-14">
            <tr th:if="${auditPage.empty}">
              <td colspan="7" class="text-center">
                <span th:if="${keyword != null and keyword != ''}" th:text="'No results found for search: ' + ${keyword}"></span>
                <span th:unless="${keyword != null and keyword != ''}">No audit trail records found.</span>
              </td>
            </tr>
            <tr th:each="audit, stat : ${auditPage.content}">
              <td th:text="${auditPage.totalElements - (auditPage.number * auditPage.size) - stat.index}"></td>
              <td th:text="${audit.id.userid}"></td>
              <td th:text="${audit.id.actiontaken}"></td>
              <td th:text="${audit.id.pageurl}"></td>
              <td th:text="${audit.id.browser} + '/' + ${audit.id.os}"></td>
              <td th:text="${audit.id.ipaddress}"></td>
              <td th:text="${#dates.format(audit.id.entrydate, 'yyyy-MM-dd HH:mm:ss')}"></td>
            </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div th:if="${auditPage.totalPages > 1}" class="mt-4">
          <nav aria-label="Pagination">
            <ul class="pagination justify-content-center flex-wrap">
              <li class="page-item" th:classappend="${auditPage.first} ? 'disabled'">
                <a class="page-link" th:href="@{/nerie/admin/audittrail(page=1, size=${auditPage.size}, keyword=${keyword})}">First</a>
              </li>
              <li class="page-item" th:classappend="${auditPage.first} ? 'disabled'">
                <a class="page-link" th:href="@{/nerie/admin/audittrail(page=${auditPage.number}, size=${auditPage.size}, keyword=${keyword})}">Previous</a>
              </li>
              <li class="page-item" th:each="pageNumber : ${pageNumbers}" th:classappend="${pageNumber == auditPage.number + 1} ? 'active'">
                <a class="page-link" th:href="@{/nerie/admin/audittrail(page=${pageNumber}, size=${auditPage.size}, keyword=${keyword})}" th:text="${pageNumber}"></a>
              </li>
              <li class="page-item" th:classappend="${auditPage.last} ? 'disabled'">
                <a class="page-link" th:href="@{/nerie/admin/audittrail(page=${auditPage.number + 2}, size=${auditPage.size}, keyword=${keyword})}">Next</a>
              </li>
              <li class="page-item" th:classappend="${auditPage.last} ? 'disabled'">
                <a class="page-link" th:href="@{/nerie/admin/audittrail(page=${auditPage.totalPages}, size=${auditPage.size}, keyword=${keyword})}">Last</a>
              </li>
            </ul>
          </nav>
        </div>

      </div>
    </div>
  </div>
</main>

<th:block layout:fragment="scripts">
  <script th:src="@{/js/auditTrail.js}"></script>
</th:block>
</body>
</html>